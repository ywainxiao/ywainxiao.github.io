<html>
  <head>
    <title>结构笔记 - ywainxiao</title>
    <link href='/images/fav.png' rel='shortcut icon'>
<link href='/atom.xml' rel='alternate' type='application/rss+xml'>
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/responsive.css">
<script src="/js/jquery.js"></script>
<script src="/js/basics.js"></script>
<meta content='width=device-width, initial-scale=1.0, user-scalable=no' name='viewport'>
<meta content='text/html; charset=utf-8' http-equiv='content-type'>


  </head>
  <body>
    <header>
  <a id='go-back-home' href='/'><img src='/images/scribble.png' alt='Home' width='53' height='59'></a>
  <p>ywainxiao</p>
  <p>enjoy code, enjoy life.</p>
</header>

    <div id='container'>
      <div class='block'>
  
    <a class='main' href='/'>Blog</a>
  
    <a class='main' href='/about'>About</a>
  
    <a class='main' href='/tags'>Tags</a>
  
    <a class='main' href='https://github.com/ywainxiao'>Github</a>
  
</div>

      <section class='paging'>
  
    <div class='left'>
      <a href='/2018/07/23/markdown语法笔记/'>
        ‹
      </a>
    </div>
  
  
    <div class='right'>
      <a href='/2018/07/17/你好-Hexxo/'>
        ›
      </a>
    </div>
  
</section>

      <div class='content'>
        <section class='post'>
          <h1>
            <div class='date'>2018-07-22</div>
            结构笔记
          </h1>
          <p>花了三天时间，把C的结构基本学完了。</p>
<h4 id="0-为什么需要结构"><a href="#0-为什么需要结构" class="headerlink" title="0.为什么需要结构"></a>0.为什么需要结构</h4><p>有人会问，C的数据类型包罗万象，为什么还要多搞出一个复杂的结构呢？原因很简单，真实场景里需要处理的不同类型的数据通常不是完全独立、不相关的，为了更好地组织管理这些相互有关联数据，结构也就“应运而生”了。</p>
<h4 id="1-结构是什么"><a href="#1-结构是什么" class="headerlink" title="1.结构是什么"></a>1.结构是什么</h4><p>结构是一个或多个变量的集合（一般都是多个，一个就没啥必要了），这些变量可以是不同的数据类型。简单点说就是把一组相关的变量看做一个整体。</p>
<h4 id="2-结构的定义"><a href="#2-结构的定义" class="headerlink" title="2.结构的定义"></a>2.结构的定义</h4><p>以平面直角坐标系中的最基本对象“点”为例，一个点包含横、纵两个坐标，用浮点数x、y表示。使用结构存放两个坐标，声明结构的语法如下<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">point</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> x;</span><br><span class="line">	<span class="keyword">int</span> y;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>关键字struct引入结构说明，struct后面的名字”point”是自己定的，叫做结构标记，用来给结构命名，以后可以用结构标记代表{}里的整个声明，直接实例化结构。结构中定义的变量x，y称为结构成员，结构成员、结构标记、普通变量（即非成员变量）可以采用相同的名字，因为通过上下文分析总可以对他们进行区分。</p>
<p>上面只是声明了一个结构（struct point），也可以说只是描述了一个结构的模版或者说框架，计算机并没有给它分配存储空间。要实例化结构，采用下面语法<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">point</span> <span class="title">pt1</span>, <span class="title">pt2</span>, <span class="title">pt3</span>;</span></span><br></pre></td></tr></table></figure></p>
<p>从语法角度来说，这种声明方式与声明<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> pt1, pt2, pt3;</span><br></pre></td></tr></table></figure></p>
<p>具有类似的意义，这两个声明都将pt1、pt2和pt3声明为指定类型的变量，并且为它们分配存储空间。</p>
<p>也可以这么理解，struct定义了一种新的数据类型（这里是struct point数据类型），这种数据类型和int、float这些数据类型基本类似，可以赋值、传递给函数，函数也可以返回这种数据类型的返回值。</p>
<p>结构的定义可以嵌套，这是说结构成员也可以是一个结构，例如我们用两个点来定义矩形：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rect</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">point</span> <span class="title">pt1</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">point</span> <span class="title">pt2</span>;</span></span><br><span class="line">&#125; screen;</span><br></pre></td></tr></table></figure></p>
<p>这时候我们可以用screen.pt1.x引用screen成员pt1的x坐标。</p>
<h4 id="3-结构的初始化"><a href="#3-结构的初始化" class="headerlink" title="3.结构的初始化"></a>3.结构的初始化</h4><p>结构初始化通常采用初值表初始化，还可以通过赋值初始化、调用函数进行初始化等方式。</p>
<p><strong><em>初值表初始化：</em></strong>在结构定义的后面使用初值表，初值表中必须是常量表达式，并且和结构的每个成员相对应，例如：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">point</span> <span class="title">pt</span> = &#123;</span> <span class="number">300</span>, <span class="number">400</span> &#125;;</span><br></pre></td></tr></table></figure></p>
<p>经常使用的一种方法是在结构声明的时候直接初始化，例如：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">point</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> x;</span><br><span class="line">	<span class="keyword">int</span> y;</span><br><span class="line">&#125; pt = &#123; <span class="number">300</span>, <span class="number">400</span> &#125;;</span><br></pre></td></tr></table></figure></p>
<p>这种情况下其实是可以省略掉结构标记point（因为这里有{}中的结构声明），但是不建议省略，一方面是为了程序可读性，另一方面是因为如果后面程序需要使用这个结构作为函数的参数或者返回值，就必须用到这个结构的结构标记。</p>
<p><strong><em>赋值初始化：</em></strong>首先实例化一个结构，然后用<strong>结构名.成员</strong>引用这个结构的成员变量，对这些变量赋值来实现初始化，例如:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">point</span> <span class="title">pt</span>;</span></span><br><span class="line">pt.x = <span class="number">300</span>;</span><br><span class="line">pt.y = <span class="number">400</span>;</span><br></pre></td></tr></table></figure></p>
<p>这种方式比较少用，更经常用到的是直接将一个已经初始化的结构作为一个整体赋值给另一个还没有初始化的结构，例如：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">point</span> <span class="title">pt1</span>;</span></span><br><span class="line">pt1 = pt; <span class="comment">//假设pt已经初始化</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>调用函数进行初始化：</em></strong>直接调用返回值是对应类型的结构的函数进行初始化，下面讲具体操作。</p>
<h4 id="4-结构与函数"><a href="#4-结构与函数" class="headerlink" title="4.结构与函数"></a>4.结构与函数</h4><p><strong><em>返回值是结构的函数：</em></strong>首先来看一下函数makepoint，它带有两个整形参数，返回一个point类型的结构：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* makepoint函数：通过x、y坐标构造一个点 */</span></span><br><span class="line"><span class="function">struct point <span class="title">makepoint</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">point</span> <span class="title">temp</span>;</span></span><br><span class="line"></span><br><span class="line">	temp.x = x;</span><br><span class="line">	temp.y = y;</span><br><span class="line">	returna temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在可以用makepoint初始化任何struct point类型的结构，例如：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">point</span> <span class="title">pt</span>;</span></span><br><span class="line">pt = makepoint(<span class="number">300</span>,<span class="number">400</span>);</span><br></pre></td></tr></table></figure></p>
<h4 id="5-结构数组"><a href="#5-结构数组" class="headerlink" title="5.结构数组"></a>5.结构数组</h4><p>考虑这么一个问题，人为设定一个关键字集合，然后输入一些字符串，统计各个关键字输入的个数。有两种思路：</p>
<p>-使用两个独立的数组分别存放<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *keyword[NKEYS];</span><br><span class="line"><span class="keyword">int</span> keycouont[NKEYS];</span><br></pre></td></tr></table></figure></p>
<p>-使用结构数组存放<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">key</span> &#123;</span></span><br><span class="line">	<span class="keyword">char</span> *word;</span><br><span class="line">	<span class="keyword">int</span> count;</span><br><span class="line">&#125; keytab[NKEYS];</span><br></pre></td></tr></table></figure></p>
<p><strong>结构数组的初始化：</strong>和结构成员相对应，初值也要按照成对的方式列出,初值之间用“,”隔开。<br>这里有一个技巧，因为这的keytab是一个固定的字符串集合，所以最好把它声明为外部变量，这样只需要初始化一次，其他所有的地方都可以用。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">key</span> &#123;</span></span><br><span class="line">	<span class="keyword">char</span> *word;</span><br><span class="line">	<span class="keyword">int</span> count;</span><br><span class="line">&#125; keytab[] = &#123;	<span class="comment">//初始化时注意初始值形式</span></span><br><span class="line">	<span class="string">"break"</span>, <span class="number">0</span>,</span><br><span class="line">	<span class="string">"case"</span>, <span class="number">0</span>,</span><br><span class="line">	<span class="string">"char"</span>, <span class="number">0</span>,</span><br><span class="line">	<span class="string">"const"</span>, <span class="number">0</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>更标准的做法是，将每一行（即每个结构）的初值都括在花括号内，如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">keytab[] = &#123;</span><br><span class="line">	&#123; <span class="string">"break"</span>, <span class="number">0</span> &#125;,</span><br><span class="line">	&#123; <span class="string">"case"</span>, <span class="number">0</span> &#125;,</span><br><span class="line">	&#123; <span class="string">"char"</span>, <span class="number">0</span> &#125;,</span><br><span class="line">	&#123; <span class="string">"const"</span>, <span class="number">0</span> &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>如果初值是简单变量（我理解的是不是其他的结构体之类的）或者是字符串，并且其中的任何值都不为空，那么内层的花括号可以省略。</p>
<p>如果初值存在并且方括号[]中没有数值，编译程序将计算数组keytab中的项数。当然我们也可以通过计算机得到它的数值，用NKEYS代表keytab中的项数，我们可以用数组keytab的长度除以数组项（就是其中的每一个结构）的长度。有下面两种实现方式：<br>-用数组长度除以单个元素类型的长度<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NKEYS (sizeof keytab / sizeof (struct key))</span></span><br></pre></td></tr></table></figure></p>
<p>-用数组长度除以一个指定元素的长度<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NKEYS (sizeof keytab / sizeof keytab[0])</span></span><br></pre></td></tr></table></figure></p>
<p>推荐使用第二种方法，这样即使数组项的类型改变，也不需要改变程序。</p>
<h4 id="6-特殊的结构：联合"><a href="#6-特殊的结构：联合" class="headerlink" title="6.特殊的结构：联合"></a>6.特殊的结构：联合</h4><p>联合（union）官方的定义是：可以（在不同时刻）保存不同类型和长度的对象的变量。联合的目的是使用一个变量（有固定的一块存储空间）合法地保存多种数据类型中任何一种类型的对象。联合的语法类型基于结构：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> u_tag &#123;</span><br><span class="line">	<span class="keyword">int</span> ival;</span><br><span class="line">	flooat fval;</span><br><span class="line">	<span class="keyword">char</span> *sval;</span><br><span class="line">&#125; u;</span><br></pre></td></tr></table></figure></p>
<p>变量u必须足够大，以保存这3中类型中最大的一种，具体长度通具体实现有关。这些类型中的任何一种类型的对象都可赋值给u，且可以使用在后面的表达式中，但必须保证是一致的：读取的类型必须是最近一次存入的类型。但要注意，联合只能用其第一个成员类型的值进行初始化。另外联合可以使用在结构和数组中，反过来也可以。</p>
<p>实际上，联合就是一个特殊的结构，它的所有成员相对于基地址的偏移量都为0，并且它的空间要大到足够容纳最“宽”的成员。</p>

          <br>
<p></p>

        </section>
      </div>
      
      <div class='block'>
  
    <a class='main' href='/'>Blog</a>
  
    <a class='main' href='/about'>About</a>
  
    <a class='main' href='/tags'>Tags</a>
  
    <a class='main' href='https://github.com/ywainxiao'>Github</a>
  
</div>

    </div>
    <footer>
  <span class='muted'>Powered by ywainxiao</span><br>
  <span class='muted'>built with Hexo using Scribble theme</a>
  <br>
  <br>
</footer>

  </body>
</html>
